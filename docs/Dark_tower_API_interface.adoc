:toc2:

= Dark Tower API Interface

This document describes the optional and mandatory variables expectd by Dark Tower


[cols="15%,10%,15%,30%,30%]
|=============================================
| Variable name | type | default | Purpose | Example

| `guid`
| String
| Mandatory
| Global Unique Identifier
| 1234

| `babylon_dark_tower_organization`
| String
| Mandatory
| Assign to Tower organization
| gpte

| `babylon_dark_tower_run_group`
| String
| us
| Hint to Dark Tower for schdeuling locality
| `emea` or `prod` 

| `babylon_deployer_scm_type`
| String
| `git`
| Type of SCM for Dark Tower project
| `git`

| `babylon_deployer_scm_url`           
| URL
| Mandatory
| Location of deployer repo
| https://github.com/redhat-cop/agnosticd.git

| `babylon_deployer_scm_ref`
| String
| `development`
| branch, commit, or tag to check out in job project
| `three-tier-app-prod-1.14`

| `babylon_deployer_scm_tag_prefix`
| String
| Optional
| Dark Tower will look up the highest release tag of that prefix | 
`three-tier-app-prod` footnote:[Mutually exclusive with `babylon_deployer_ref` *WARNING* abbreviated prefixes may lead to undesired effects e.g. `three-tier-app` would fetch the highest test tag and *not* rpoduction.]


| `babylon_deployer_type`
| String
| `agnosticd`
| Create maningfully named tower objects and log output
| `agnosticd`

| `babylon_deployer_action`            deploy 
| String
| deploy
| Log output and hints to dark tower as to type of workload
| `deploy|stop|start|destroy` etc.,

| `babylon_deployer_entry_point`
| String
| Mandatory
| Entry playbook for Dark Tower Job Template
| `ansible/main.yml`

| `babylon_callback_url`
| URL
| Optional
| Callback URL for Dark Tower to communicate Job Status
| http://reciever.openshift.example.com/callback

| `babylon_callback_token`
| Optional
| Callback Token for Dark Tower to communicate Job Status
| EIEp   IO
| `sY45jk7632ooi43oiu`
|=============================================

.Sample Var File for agnosticd link:https://github.com/redhat-cop/agnosticd/tree/development/ansible/configs/three-tier-app[config `three-tier-app`]
[source,yaml]
----

---
guid:                               baby-three-01

babylon_dark_tower_organization:    gpte
babylon_dark_tower_run_group:       emea  # e.g.region hint, stage hint (dev|prod)

babylon_deployer_scm_type:          git
babylon_deployer_scm_url:           https://github.com/redhat-cop/agnosticd.git
babylon_deployer_scm_ref:           three-tier-app-prod-1.14
# babylon_deployer_scm_tag_prefix:    three-tier-app-prod  # Dynamic lookup of latest tag

babylon_deployer_type:              agnosticd # default agnosticd
babylon_deployer_action:            deploy 
babylon_deployer_entry_point:       ansible/main.yml

babylon_callback_url:               ""
babylon_callback_token:             "" 

environment_parameters:

----
